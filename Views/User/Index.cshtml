@model mvcglobal.Models.ModelUser
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="container">
    <div class="col-sm-7 col-sm-offset-3">
        <p class="label-info" style="text-align:center;font-weight:bold;font-size:20px; height:30px;color:white">System  User Creation Window </p>
    </div>
    <br />
    <br />
    <br />
    <div class="col-sm-10 col-sm-offset-1">
        <div class="row">

            <div id="userform">

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> User Id :</span>
                    </div>
                    <div class="col-sm-4">
                        <input id="txtUserId" class="form-control" placeholder="User Id" readonly />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> User Full Name :</span>
                    </div>
                    <div class="col-sm-4">
                        <input id="txtUserName" class="form-control" placeholder="User Full Name" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Designation :</span>
                    </div>

                    <div class="col-sm-4">
                        @if (ViewBag.DesignationList != null)
                        {
                            @Html.DropDownList("ddlDesignation", new SelectList(ViewBag.DesignationList, "Value", "Text"), "Select Deisgnation", new { @class = "form-control", @id = "ddlDesignation" })
                        }

                        @*@Html.DropDownListFor(m => m.DropDownInfo, new SelectList(Model.DropDownInfo, "DesignationId", "DesignationName"), "Select Designation", new { @class = "form-control", @id = "ddlDesignation" })*@
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Joining Date :</span>
                    </div>
                    <div class="col-sm-4">
                        <input class="form-control" id="txtJoinigDate" type="text" placeholder="Select Joing Date" autocomplete="off" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Phone Number :</span>
                    </div>

                    <div class="col-sm-4">
                        <input id="txtPhoneNumber" class="form-control" placeholder="Phone Number" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Email :</span>
                    </div>
                    <div class="col-sm-4">
                        <input id="txtEmailAddress" class="form-control" placeholder="Email Address" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Address :</span>
                    </div>

                    <div class="col-sm-4">
                        <input id="txtAddress" class="form-control" placeholder="Address" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Login Name :</span>
                    </div>
                    <div class="col-sm-4">
                        <input id="txtLoginName" class="form-control" placeholder="Login Name" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> User Group :</span>
                    </div>

                    <div class="col-sm-4">

                        @Html.DropDownListFor(m => m.GroupInfo, new SelectList(Model.GroupInfo, "GroupId", "GroupName"), "Select Group", new { @class = "form-control", @id = "ddlGroup" })
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Password :</span>
                    </div>

                    <div class="col-sm-4">
                        <input id="txtPassword" type="password" class="form-control" placeholder="Password" />
                    </div>
                </div>


                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Branch Name :</span>
                    </div>
                    <div class="col-sm-4">

                        @if (ViewBag.BranchList != null)
                        {
                            @Html.DropDownList("ddlBranch", new SelectList(ViewBag.BranchList, "Value", "Text"), "Select Branch", new { @class = "form-control", @id = "ddlBranch" })
                        }

                        @*@Html.DropDownList("ObjList", (IEnumerable<SelectListItem>)ViewBag.Locations, "Select Branch", new { id = "ddlBranch", @class = "form-control" })*@
                        @*@Html.DropDownList("ObjList", (List<SelectListItem>)ViewBag.Locations, new { multiple = "multiple" })*@
                        @*@Html.DropDownListFor(m => m.BranchInfo, new SelectList(Model.BranchInfo, "BranchId", "BranchTitle"), "Select Branch", new { @class = "form-control", @id = "ddlBranch" })*@
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-2">
                        <span> Confirm Password :</span>
                    </div>
                    <div class="col-sm-4">
                        <input id="txtConfirmPassword" type="password" class="form-control" placeholder="Confirm Password" />
                    </div>
                </div>
            </div>
        </div>

        <br />
        <div class="col-sm-6 col-sm-offset-5">
            <button id="btnAddNew" class="btn btn-success" type="button"> Add New</button>
            <button id="btnUpdate" class="btn btn-success" type="button" style="display:none">Update</button>
            <button id="btnCancel" class="btn btn-success" type="button" style="display:none"> Cancel</button>
            <button id="btnSave" class="btn btn-success" type="button"> Save</button>
        </div>
    </div>
</div>

<hr />
<div class="container-fluid">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-body">
                <table class="table table-hover  table-bordered" id="UserCreationTable" style="background-color:white !important;font-size:12px !important;">
                    <thead>
                        <tr>
                            <th style="width:50px!important;">User Id</th>
                            <th>Full Name</th>
                            <th>Login Name</th>
                            <th style="display:none;">Designation Id</th>
                            <th>Designation Name</th>
                            <th>Phone</th>
                            <th>Email Address</th>
                            <th>Address</th>
                            <th style="display:none;">Branch Id</th>
                            <th>Branch Name</th>
                            <th style="display:none;">Group Id</th>
                            <th>Group Name</th>
                            <th>Created By</th>
                            <th style="width:135px !important; text-align:center;">Action</th>
                        </tr>
                    </thead>
                    @foreach (var item in @ViewBag.UserInfo as List<mvcglobal.Models.ModelUser>)
                    {
                        <tr>
                            <td class="UserId">@item.UserId</td>
                            <td class="UserFullName">@item.UserFullName</td>
                            <td class="UserLoginName">@item.UserLoginName</td>
                            <td class="DesigantionId" style="display:none">@item.DesignationId</td>
                            <td class="DesignationName">@item.DesignationName</td>
                            <td class="Phone">@item.Phone</td>
                            <td class="EmailAddress">@item.EmailAddress</td>
                            <td class="EmailAddress">@item.Address</td>
                            <td class="BranchId" style="display:none">@item.BranchId</td>
                            <td class="BranchTitle">@item.BranchTitle</td>
                            <td class="GroupId" style="display:none">@item.GroupId</td>
                            <td class="GroupName">@item.GroupName</td>
                            <td class="CreationBy">@item.CreationBy</td>
                            <td><a id="@item.UserId" href="javascript:;" class="Edit_class btn btn-default" style="width:80px !important;">Edit</a>  <a id="@item.UserId" href="javascript:;" class="Delete_class btn btn-danger">Delete</a></td>

                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">
    $(function () {
        $("#txtJoinigDate").datepicker({
            dateFormat: "dd/mm/yy",
        }).datepicker("setDate", "0");
    });
    $("#txtJoinigDate").datepicker({
        dateFormat: "dd/mm/yy",
        changeMonth: true,
        changeYear: true,
        yearRange: '1964:2030',
    });

    $('#UserCreationTable').dataTable({
    });

    $('#btnAddNew').click(function () {
        var valid = this.checkValidity();
        if (valid) {
            debugger;
            event.preventDefault()
            var strUserId = $("#txtUserId").val();
            $.ajax({
                type: "POST",
                url: "/User/ShowUserId",
                data: '{strUserId:"' + strUserId + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, status) {
                    $("#txtUserId").val(data[0]);
                    $("#txtUserName").val("");
                    $("#txtLoginName").val("");
                    $("#txtPhoneNumber").val("");
                    $("#txtEmailAddress").val("");
                    $("#txtAddress").val("");
                    $("#txtPassword").val("");
                    $("#txtConfirmPassword").val("");
                    $("#txtJoinigDate").val("");


                }
            });
        }
    });

    $('#btnSave').click(function () {
        var valid = this.checkValidity();
        $("#valid").html(valid);
        if (valid) {
            debugger;
            event.preventDefault()
            var UserId = $("#txtUserId").val();
            var UserFullName = $("#txtUserName").val();
            var UserLoginName = $("#txtLoginName").val();
            var Phone = $("#txtPhoneNumber").val();
            var EmailAddress = $("#txtEmailAddress").val();
            var Address = $("#txtAddress").val();
            var JoiningDate = $("#txtJoinigDate").val();
            var LoginPassword = $("#txtPassword").val();
            var ConfirmPassword = $("#txtConfirmPassword").val();
            var GroupId = $("#ddlGroup").find("option:selected").val();
            var BranchId = $("#ddlBranch").find("option:selected").val();
            var DesignationId = $("#ddlDesignation").find("option:selected").val();

            $.ajax({
                type: "POST",
                url: "/User/AddUser",
                data: '{UserId:"' + UserId + '",UserFullName:"' + UserFullName + '", UserLoginName:"' + UserLoginName + '",Phone:"' + Phone + '",EmailAddress:"' + EmailAddress + '", Address:"' + Address + '",JoiningDate:"' + JoiningDate + '",LoginPassword:"' + LoginPassword + '", ConfirmPassword:"' + ConfirmPassword + '",GroupId:"' + GroupId + '", BranchId:"' + BranchId + '",DesignationId:"' + DesignationId + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, status) {
                    if (data == "Successful") {
                        swal("Added!", "Data Added Successfully.", "success");

                        $("#txtUserId").val();
                        $("#txtUserName").val("");
                        $("#txtLoginName").val("");
                        $("#txtPhoneNumber").val("");
                        $("#txtEmailAddress").val("");
                        $("#txtAddress").val("");
                        $("#txtPassword").val("");
                        $("#txtConfirmPassword").val("");
                        $("#txtJoinigDate").val("");

                        window.location.href = '/User/Index';

                    }
                    else {
                        swal(data);
                    }
                }
            });
        }
    });

    $('.Edit_class').on('click', function () {
        $("#btnAddNew").hide();
        $("#btnSave").hide();
        $("#btnUpdate").show();
        $("#btnCancel").show();
        debugger;

        var row = $(this).closest("tr");
        UserId = row.find(".ItemId").html();
        UserName = row.find(".ItemName").html();
        LoginName = row.find(".UserLoginName").html();
        GroupId = row.find(".GroupId").html();
        BranchId = row.find(".BranchId").html();
        DesignationId = row.find(".DesigantionId").html();


        $(window).scrollTop(0);
        $("#txtUserId").val(UserId);
        $("#txtUserName").val(UserName);
        $("#txtLoginName").val(LoginName);
        $("#ddlGroup").bind("option:selected").val(GroupId);
        $("#ddlBranch").bind("option:selected").val(BranchId);
        $("#ddlDesignation").bind("option:selected").val(DesignationId);

        // var strCategoryId = $("#ddlCategory").find("option:selected").val();
        // var strCategoryName = $("#ddlCategory").find("option:selected").text();

        $(window).scrollTop(0);
    });


    $('.Delete_class').on('click', function () {

        var UserId = this.id;
        var TableName = $(this).closest('.caption').children('.title').text();
        swal({
            title: "Are you sure want to Delete?",
            text: "You will not be able to recover this file!",
            type: "warning",
            showCancelButton: true,
            confirmButtonText: "Yes",
            cancelButtonText: "No",
            closeOnConfirm: false,
            closeOnCancel: false
        }, function (isConfirm) {
            if (isConfirm) {

                $.ajax({
                    type: "POST",
                    url: "/User/DeleteUserData",
                    data: '{UserId:"' + UserId + '"}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",

                    success: function (data, status) {
                        if (data == "Successful") {
                            swal("Deleted!", "Your imaginary file has been deleted.", "success");
                            window.location.href = '/User/Index';

                        }
                        else {
                            swal("Something went wrong!", "error");
                        }
                    },

                });


            } else {
                swal("Cancelled", "Your file is safe :)", "error");
            }
        });

    });


    $('#btnUpdate').click(function () {
        var UserId = $("#txtUserId").val();
        var UserFullName = $("#txtUserName").val();
        var UserLoginName = $("#txtLoginName").val();
        var GroupId = $("#ddlGroup").find("option:selected").val();
        var BranchId = $("#ddlBranch").find("option:selected").val();
        var DesignationId = $("#ddlDesignation").find("option:selected").val();

        // var strCategoryId = $("#ddlCategory").find("option:selected").val();

        debugger;
        $.ajax
            ({
                type: "POST",
                url: "/User/UpdateUserData",
                data: '{UserId:"' + UserId + '",UserFullName:"' + UserFullName + '", UserLoginName:"' + UserLoginName + '",GroupId:"' + GroupId + '", BranchId:"' + BranchId + '",DesignationId:"' + DesignationId + '"}',
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (data, status) {
                    if (data == "Successful") {
                        swal("Updated!", "Your imaginary file has been Updated.", "success");

                        $("#txtUserId").val();
                        $("#txtUserName").val("");
                        $("#txtLoginName").val("");
                        $("#txtPhoneNumber").val("");
                        $("#txtEmailAddress").val("");
                        $("#txtAddress").val("");
                        $("#txtPassword").val("");
                        $("#txtConfirmPassword").val("");
                        $("#txtJoinigDate").val("");
                        $("#btnAddNew").show();
                        $("#btnSave").show();
                        $("#btnUpdate").hide();
                        $("#btnCancelC").hide();

                        window.location.href = '/User/Index';

                    }
                    else {
                        swal("Something went wrong!", "error");
                    }
                }
            })
    });

    $('#btnCancel').click(function () {

        $("#txtUserId").val("");
        $("#txtUserName").val("");
        $("#txtLoginName").val("");
        $("#txtPhoneNumber").val("");
        $("#txtEmailAddress").val("");
        $("#txtAddress").val("");
        $("#txtPassword").val("");
        $("#txtConfirmPassword").val("");
        $("#txtJoinigDate").val("");
        $("#btnAddNew").show();
        $("#btnSave").show();

    });

</script>

